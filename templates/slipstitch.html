{% extends "template.html" %}

{% block content %}
  <style>
    /* ========== Carousel CSS ========== */
    .carousel, .single-media {
      position: relative;
      max-width: 600px;
      margin: 1rem auto 2rem;
      overflow: hidden;
    }
    .carousel-track {
      display: flex;
      transition: transform 0.5s ease;
      list-style: none;      
      margin: 0; padding: 0;
    }
    .carousel-slide {
      min-width: 100%;
      position: relative;
    }
    .carousel-slide.shadowed {
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .carousel-slide img,
    .carousel-slide video,
    .single-media img,
    .single-media video {
      width: 100%;
      display: block;
    }
    .carousel-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.75);
      border: none;
      font-size: 2rem;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      z-index: 1;
    }
    .carousel-button.prev { left: 0.5rem; }
    .carousel-button.next { right: 0.5rem; }
  </style>

  <h2 class="step-title">{{ step_title }}</h2>

  {% if media|length > 1 %}
    <div class="carousel">
      <button class="carousel-button prev">‹</button>
      <ul class="carousel-track">
        {% for m in media %}
          <li class="carousel-slide{% if not loop.last %} shadowed{% endif %}">
            {% if m.type == 'image' %}
              <img src="{{ url_for('static', filename=m.src) }}" alt="{{ m.alt }}">
            {% else %}
              <video src="{{ url_for('static', filename=m.src) }}" controls></video>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
      <button class="carousel-button next">›</button>
    </div>
  {% else %}
    {% set m = media[0] %}
    <div class="single-media">
      {% if m.type == 'image' %}
        <img src="{{ url_for('static', filename=m.src) }}" alt="{{ m.alt }}">
      {% else %}
        <video src="{{ url_for('static', filename=m.src) }}" controls></video>
      {% endif %}
    </div>
  {% endif %}

  <ul>
    {% for bullet in instructions %}
      <li>{{ bullet }}</li>
    {% endfor %}
  </ul>

  <div class="nav-buttons">
    {% if prev_step is not none %}
      <a href="{{ url_for('slipstitch_step', step=prev_step) }}" class="nav-button">← Previous</a>
    {% endif %}
    {% if next_step is not none %}
      <a href="{{ url_for('slipstitch_step', step=next_step) }}" class="nav-button">Next →</a>
    {% else %}
      <a href="{{ url_for('quiz') }}" class="nav-button">Start Quiz</a>
    {% endif %}
  </div>
{% endblock %}
